name: Backend CI (Spring Boot)

# Trigger: Run on every push to main or pull request
on:
  push:
    branches: [ "main" ]
    paths:
      - 'backend/**' # Only run if backend code changes
  pull_request:
    branches: [ "main" ]
    paths:
      - 'backend/**'

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    
    defaults:
      run:
        working-directory: ./backend # ðŸŸ¢ CRITICAL: Tells GitHub to run commands in the 'backend' folder

    steps:
    # 1. Checkout your code
    - uses: actions/checkout@v4

    # 2. Set up Java 17 (Required for Spring Boot 3)
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven

    # 3. Run Tests (The "mvn test" command)
    - name: Build and Run Tests
      run: mvn -B test --file pom.xml
      
    # 4. Optional: Upload Test Results so you can see them in GitHub UI
    - name: Publish Test Report
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: test-results
        path: backend/target/surefire-reports